# mysql

## b+tree索引
1.多路绝对平衡树。
2.扫库扫表能力更强。
3.磁盘读写能力更强。
4.排序能力。
5.查询效率稳定。

## 为什么mysql页文件默认配置16KB？
我们假设一行的数据是1K，那我们一页的数据，就能存储16行数据，也就是一个叶节点可以存储16条记录；再来看非叶节点，假设ID是bigint类型，那么长度为8B，指针大小在InnoDB源码中为64（6B），一共就是14B，那么一页里面就可以存储16K/14=1170个（主键+指针）
那么一颗高度为2的B+树能存储的数据为：1170*16=18720条，一颗高度为3的B+树可以存储1170*1170*16=21902400（千万条）
原因就是16KB就足够应对千万条表记录了。

## 设置mysql慢查询分析
使用explain工具查看执行计划
```sql
show variables like 'slow%';
```

## mysql的行锁
Innodb的行锁是通过索引上的索引项加锁，否则使用表锁。非主键索引的话，则会锁住非主键索引和主键索引（两把锁）。
**合理建立索引，尽量让事务使用到索引，防止表锁**

## 意向锁
当数据库存在行级锁的时候，有个操作需要添加表级锁，这个时候如果只需要判断是否存在意向锁就可以，不需要每行的锁都判断一遍。

## MVCC (Multi-Version Concurrency Control)
多版本并发控制